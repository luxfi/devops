# Per-org Bot KMS secret sync template (multi-tenant isolation)
#
# Replace:
# - __ORG_SLUG__        (e.g. hanzo, lux, zoo)
# - __BOT_SLUG__        (e.g. support-bot, devrel-bot)
# - __NAMESPACE__       (e.g. hanzo)
#
# Security model:
# - One machine identity per org/bot scope.
# - One KMSSecret per org/bot scope.
# - One managed Kubernetes Secret per org/bot scope.
# - No shared credentials across organizations.
#
# Create auth credential secret out-of-band:
#   kubectl -n __NAMESPACE__ create secret generic bot-kms-auth-__ORG_SLUG__-__BOT_SLUG__ \
#     --from-literal=clientId=<id> \
#     --from-literal=clientSecret=<secret> \
#     --dry-run=client -o yaml | kubectl apply -f -
---
apiVersion: secrets.lux.network/v1alpha1
kind: KMSSecret
metadata:
  name: bot-kms-sync-__ORG_SLUG__-__BOT_SLUG__
  namespace: __NAMESPACE__
  labels:
    app.kubernetes.io/name: bot-site
    app.kubernetes.io/component: secrets
    app.kubernetes.io/part-of: hanzo-platform
    hanzo.ai/org: __ORG_SLUG__
    hanzo.ai/bot: __BOT_SLUG__
spec:
  hostAPI: https://kms.hanzo.ai
  resyncInterval: 60
  authentication:
    universalAuth:
      credentialsRef:
        secretName: bot-kms-auth-__ORG_SLUG__-__BOT_SLUG__
        secretNamespace: __NAMESPACE__
      secretsScope:
        # Option A: per-org project in KMS
        projectSlug: bot-__ORG_SLUG__
        envSlug: production
        # Option B: shared project + path partitioning (uncomment and adapt)
        # projectSlug: bot
        # envSlug: production
        # secretsPath: /orgs/__ORG_SLUG__/bots/__BOT_SLUG__
        secretsPath: /
  managedSecretReference:
    secretName: bot-secrets-__ORG_SLUG__-__BOT_SLUG__
    secretNamespace: __NAMESPACE__
    secretType: Opaque
